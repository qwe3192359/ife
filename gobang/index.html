<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .wrap{
            position: relative;
            text-align: center;
        }
        .can {
            border: 1px solid #eee;
        }
        .wrap .win{
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            display: none;
            justify-content: center;
            align-items: center;
        }
        .wrap .win span{
            padding: 5px 6px;
            background: #00cc00;
            color: #fff;
            border-radius: 3px;
        }
    </style>
</head>
<body>
<div class="wrap" id="wrap">
    <canvas id="can" class="can" width="500" height="500"></canvas>
    <div class="win" id="win">
        <span>胜利</span>
    </div>
</div>

<script>
    //五子棋构造函数
    function Gobang() {
        //获取canvas元素
        this.drawing = document.getElementById('can');
        this.con = this.drawing.getContext('2d');
        //当前落子颜色，黑棋或白棋，true白棋
        this.man = true;
        //棋子数组
        this.piecesArray = [];       //落下的所有棋子数据
        this.whitePiecesArray = [];  //白棋数据
        this.blackPiecesArray = [];  //黑棋数据
        //参数配置
        this.customConfig = {
            wrapBor: '',
            canBor: '',

        }
    }
    //修改原型
    Gobang.prototype = {
        //绘制棋牌
        _draw: function () {
            this.con.strokeStyle = '#eee';    //描边矩形颜色，棋盘网格颜色
            this.con.beginPath();    //开始路径
            this.con.translate(40, 40);   //移动坐标原点
            //循环绘制棋盘路径
            for (let i = 0; i < 15; i++) {
                this.con.moveTo(0, i * 30);
                this.con.lineTo(420, i * 30);
            }
            for (let i = 0; i < 15; i++) {
                this.con.moveTo(i * 30, 0);
                this.con.lineTo(i * 30, 420);
            }
            this.con.stroke();
        },
        //绑定棋盘落子事件
        _pieceEvent: function () {
            let that = this;
            that.drawing.onclick = function (e) {
                //点击的位置在棋盘的几行几列
                let x = Math.round((e.offsetX - 40) / 30);
                let y = Math.round((e.offsetY - 40) / 30);
                //如果当前位置已有棋子则不能落子
                for (let i = 0; i < that.piecesArray.length; i++) {
                    if (that.piecesArray[i][0] === x && that.piecesArray[i][1] === y) {
                        return
                    }
                }
                //只能在棋盘内落子
                if (x >= 0 && x < 15 && y >= 0 && y < 15) {
                    that._piece(x, y);
                }
            };
        },
        //落子
        _piece: function (x, y) {
            //白棋棋子渐变
            let black = this.con.createRadialGradient(x * 30, y * 30, 5, x * 30, y * 30, 15);
            black.addColorStop(0, '#0a0a0a');
            black.addColorStop(1, '#666');
            //黑棋棋子渐变
            let white = this.con.createRadialGradient(30, 30, 5, 30, 30, 15);
            white.addColorStop(0, '#f9f9f9');
            white.addColorStop(1, '#d1d1d1');
            //当前落子为黑棋还是白棋
            if (this.man) {
                this.con.fillStyle = white;
                this.man = false;
                //保存棋子
                this.piecesArray.push([x, y]);
                this.whitePiecesArray.push([x, y]);
            }
            else {
                this.con.fillStyle = black;
                this.man = true;
                //保存棋子
                this.piecesArray.push([x, y]);
                this.blackPiecesArray.push([x, y]);
            }
            //绘制棋子
            this.con.beginPath();
            this.con.arc(x * 30, y * 30, 14, 0, 2 * Math.PI, false);
            this.con.fill();

            this._victory();
        },
        //胜负判定
        _victory: function () {
            //将黑、白棋数组保存在新的数组里
            let newWhitePiecesArray = this.whitePiecesArray.concat();
            let newBlackPiecesArray = this.blackPiecesArray.concat();
            if (newWhitePiecesArray.length < 5) {
                return
            }
            if (this._verticalWin(newWhitePiecesArray) || this._acrossWin(newWhitePiecesArray)) {
                console.log('白棋胜利');
                this._winModal('白棋胜利');
            }
            else if (this._verticalWin(newBlackPiecesArray) || this._acrossWin(newBlackPiecesArray)) {
                console.log('黑棋胜利');
                this._winModal('黑棋胜利');
            }
        },
        //按照竖排排序，从左到右，从上到下
        _verticalSort: function (arr) {
            arr.sort(function (a, b) {
                if (a[0] > b[0]) {
                    return 1
                }
                else if (a[0] === b[0] && a[1] > b[1]) {
                    return 1
                }
                else {
                    return -1
                }
            });
            return arr
        },
        //按照横排排序，从上到下，从左到右
        _acrossSort: function (arr) {
            arr.sort(function (a, b) {
                if (a[1] > b[1]) {
                    return 1
                }
                else if (a[1] === b[1] && a[0] > b[0]) {
                    return 1
                }
                else {
                    return -1
                }
            });
            return arr
        },
        //竖排排序后胜负判断
        _verticalWin: function (arr) {
            arr = this._verticalSort(arr);
            //竖排胜利
            let j = 0;
            for (let i = 0; i < arr.length - 1; i++) {
                if (arr[i][0] === arr[i + 1][0] && arr[i][1] + 1 === arr[i + 1][1]) {
                    j++;
                    if (j === 4) {
                        console.log('胜利');
                        return true
                    }
                }
                else {
                    j = 0;
                }
            }

            //斜排胜利
            let k = 1;
            for (let i = 0; i < arr.length - 1; i++) {
                for (let j = 1; j < arr.length; j++) {
                    if (arr[i][0] + k === arr[j][0] && arr[i][1] + k === arr[j][1]) {
                        k++;
                        if (k === 5) {
                            console.log('胜利');
                            return true
                        }
                    }
                    else {
                        k = 1
                    }
                }
            }

        },
        //横排排序后胜负判断
        _acrossWin: function (arr) {
            arr = this._acrossSort(arr);
            //横排胜利
            let j = 0;
            for (let i = 0; i < arr.length - 1; i++) {
                if (arr[i][1] === arr[i + 1][1] && arr[i][0] + 1 === arr[i + 1][0]) {
                    j++;
                    if (j === 4) {
                        console.log('胜利');
                        console.log(arr)
                        return true
                    }
                }
                else {
                    j = 0;
                }
            }

            //反斜排胜利
            let k = 1;
            for (let i = 0; i < arr.length - 1; i++) {
                for (let j = 1; j < arr.length; j++) {
                    if (arr[i][1] + k === arr[j][1] && arr[i][0] - k === arr[j][0]) {
                        k++;
                        if (k === 5) {
                            console.log('胜利');
                            return true
                        }
                    }
                    else {
                        k = 1
                    }
                }
            }
        },
        //结束后出现的模态框
        _winModal: function (text) {
            let that = this;
            document.getElementById('win').style.display = 'flex';
            document.getElementById('win').innerText = text;
            document.getElementById('win').onclick = function () {
                that.clear();
                document.getElementById('win').style.display = 'none';
            }

        },
        //重置
        clear: function () {
            //重置画布
            this.drawing.width = 500;
            this.man = true;
            //重置棋子数据
            this.piecesArray = [];       //落下的所有棋子数据
            this.whitePiecesArray = [];  //白棋数据
            this.blackPiecesArray = [];  //黑棋数据
            this.create();
        },
        //创建五子棋
        create: function () {
            this._draw();
            this._pieceEvent();
        }
    };
    //创建五子棋
    let newGobang = new Gobang();
    //初始化
    newGobang.create();


</script>
</body>
</html>